{% extends "portal/base_home.html" %}
{% load static %}

{% block title %}S·ª± ki·ªán{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'portal/css/event_list.css' %}">
{% endblock %}

{% block content %}
<div class="lb-page">

  <!-- 1) Category row -->
  <div class="lb-categories">
    <a class="lb-cat" href="?category=workshop-hoc-tap">
      <div class="lb-cat__icon">üìò</div>
      <div class="lb-cat__text">Workshop,<br>H·ªçc t·∫≠p</div>
    </a>
    <a class="lb-cat" href="?category=am-nhac-tiec-tung">
      <div class="lb-cat__icon">üéµ</div>
      <div class="lb-cat__text">√Çm nh·∫°c,<br>Ti·ªác t√πng</div>
    </a>
    <a class="lb-cat" href="?category=am-thuc-trai-nghiem">
      <div class="lb-cat__icon">üçΩÔ∏è</div>
      <div class="lb-cat__text">·∫®m th·ª±c,<br>Tr·∫£i nghi·ªám</div>
    </a>
    <a class="lb-cat" href="?category=the-thao-suc-khoe">
      <div class="lb-cat__icon">üèÉ</div>
      <div class="lb-cat__text">Th·ªÉ thao,<br>S·ª©c kh·ªèe</div>
    </a>
    <a class="lb-cat" href="?category=so-thich-giai-tri">
      <div class="lb-cat__icon">‚ô£Ô∏è</div>
      <div class="lb-cat__text">S·ªü th√≠ch,<br>Gi·∫£i tr√≠</div>
    </a>
    <a class="lb-cat" href="?category=hoat-dong-cong-dong">
      <div class="lb-cat__icon">ü§ù</div>
      <div class="lb-cat__text">Ho·∫°t ƒë·ªông,<br>C·ªông ƒë·ªìng</div>
    </a>
    <a class="lb-cat" href="?category=van-hoa-le-hoi">
      <div class="lb-cat__icon">üìÖ</div>
      <div class="lb-cat__text">VƒÉn h√≥a,<br>L·ªÖ h·ªôi</div>
    </a>
    <a class="lb-cat" href="?category=nghe-nghiep-dinh-huong">
      <div class="lb-cat__icon">üßæ</div>
      <div class="lb-cat__text">Ngh·ªÅ nghi·ªáp,<br>ƒê·ªãnh h∆∞·ªõng</div>
    </a>
  </div>

  <!-- 2) Filter bar -->
  <form method="get" class="lb-filters">
    <div class="lb-search">
      <span class="lb-search__icon">üîé</span>
      <input
        type="text"
        name="q"
        value="{{ filters.q|default:'' }}"
        placeholder="T√¨m ki·∫øm S·ª± ki·ªán"
      />
    </div>

    <!-- ‚úÖ Lo·∫°i s·ª± ki·ªán = category -->
    <select name="category" class="lb-select">
      {% for val, label in CATEGORY_CHOICES %}
        <option value="{{ val }}" {% if filters.category == val %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>

    <!-- ‚úÖ Khu v·ª±c = area -->
    <select name="area" class="lb-select">
      <option value="">Khu v·ª±c</option>
      {% for a in areas %}
        <option value="{{ a }}" {% if filters.area == a %}selected{% endif %}>{{ a }}</option>
      {% endfor %}
    </select>

    <!-- ‚úÖ C√¢u l·∫°c b·ªô = club -->
    <select name="club" class="lb-select">
      <option value="">C√¢u l·∫°c b·ªô</option>
      {% for c in clubs %}
        <option value="{{ c.id }}" {% if filters.club == c.id|stringformat:"s" %}selected{% endif %}>
          {{ c.name }}
        </option>
      {% endfor %}
    </select>

    <!-- ‚úÖ Tr·∫°ng th√°i = status -->
    <select name="status" class="lb-select">
      <option value="all" {% if filters.status|default:'all' == "all" %}selected{% endif %}>Tr·∫°ng th√°i</option>
      <option value="upcoming" {% if filters.status == "upcoming" %}selected{% endif %}>S·∫Øp di·ªÖn ra</option>
      <option value="ended" {% if filters.status == "ended" %}selected{% endif %}>ƒê√£ k·∫øt th√∫c</option>
    </select>

    <!-- ‚úÖ Sort ch·∫°y th·∫≠t -->
    <select name="sort" class="lb-select">
      {% for val, label in SORT_CHOICES %}
        <option value="{{ val }}" {% if filters.sort == val %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>

    <a class="lb-reset" href="{% url 'portal:event_list' %}">B·ªè l·ªçc</a>
  </form>

  <!-- 3) Event list -->
  <div class="lb-events">
    {% if events %}
      {% for event in events %}
        <div class="lb-event">
          <div class="lb-event__media">
            <div class="lb-event__thumb">
              <span>·∫¢nh</span>
            </div>
          </div>

          <div class="lb-event__body">
            <!-- ‚úÖ Tag theo category -->
            <div class="lb-event__tag">{{ event.get_category_display|default:event.category }}</div>

            <div class="lb-event__title">{{ event.title }}</div>

            <div class="lb-event__meta">
              <div class="lb-meta-line">üë§ {{ event.club.name }}</div>
              {% if event.location %}
                <div class="lb-meta-line">üìç {{ event.location }}</div>
              {% endif %}
            </div>

            <div class="lb-event__actions">
              <a class="lb-btn" href="{% url 'portal:event_detail' event.id %}">Xem chi ti·∫øt</a>
            </div>
          </div>

          <div class="lb-event__date">
            <div class="lb-datebox">
              {% if event.event_date %}
                <div class="lb-datebox__day">{{ event.event_date|date:"d" }}</div>
                <div class="lb-datebox__month">Th√°ng {{ event.event_date|date:"m" }}</div>
              {% else %}
                <div class="lb-datebox__day">--</div>
                <div class="lb-datebox__month">Ch∆∞a c√≥ ng√†y</div>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="lb-empty">Kh√¥ng c√≥ s·ª± ki·ªán ph√π h·ª£p.</div>
    {% endif %}
  </div>

</div>
{% endblock %}
