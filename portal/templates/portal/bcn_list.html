{% extends "portal/base_admin.html" %}
{% load static %}

{% block title %}Tài khoản BCN{% endblock %}
{% block menu_bcn_active %}active{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'portal/css/bcn.css' %}">

<div class="panel-box">
  <div class="bcn-toolbar">
    <form method="get" class="bcn-search">
      <input name="q" value="{{ q }}" placeholder="Tìm theo tên / username / email / CLB" />
      <button type="submit">Tìm</button>
    </form>

    <a class="btn-primary" href="{% url 'portal:admin_panel:bcn_create' %}">+ Tạo tài khoản BCN</a>
  </div>

  <table class="bcn-table">
    <thead>
      <tr>
        <th>Họ tên</th>
        <th>Username</th>
        <th>Email</th>
        <th>CLB</th>
        <th>Trạng thái</th>
        <th>Hành động</th>
      </tr>
    </thead>

    <tbody>
      {% for p in profiles %}
        <tr>
          <td>{{ p.full_name }}</td>
          <td>{{ p.user.username }}</td>
          <td>{{ p.user.email }}</td>
          <td>{% if p.club %}{{ p.club.name }}{% else %}-{% endif %}</td>

          <td>
            {% if p.is_locked %}
              <span class="badge badge-danger">Khoá</span>
            {% else %}
              <span class="badge badge-success">Hoạt động</span>
            {% endif %}
          </td>

          <td style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
            <!-- ✅ US-A3.2 (CŨ) - Reset mật khẩu: GIỮ NGUYÊN -->
            <a
              class="btn-secondary"
              href="{% url 'portal:admin_panel:bcn_reset_password' p.user.id %}"
              onclick="return confirm('Bạn chắc chắn muốn reset mật khẩu cho BCN: {{ p.user.username }} ?');"
              style="text-decoration:none;"
            >
              Reset mật khẩu
            </a>

            <!-- ✅ US-A3.4 (THÊM MỚI) - Khoá/Mở khoá -->
            <a
              class="{% if p.user.is_active %}btn-danger{% else %}btn-success{% endif %}"
              href="{% url 'portal:admin_panel:bcn_toggle_lock' p.user.id %}"
              onclick="return confirm('{% if p.user.is_active %}Bạn chắc chắn muốn KHOÁ tài khoản BCN: {{ p.user.username }} ?{% else %}Bạn chắc chắn muốn MỞ KHOÁ tài khoản BCN: {{ p.user.username }} ?{% endif %}');"
              style="text-decoration:none;"
            >
              {% if p.user.is_active %}
                Khoá
              {% else %}
                Mở khoá
              {% endif %}
            </a>
          </td>
        </tr>
      {% empty %}
        <tr><td colspan="6">Chưa có tài khoản BCN.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
