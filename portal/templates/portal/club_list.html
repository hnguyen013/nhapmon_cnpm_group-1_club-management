{% extends "portal/base_home.html" %}
{% load static %}

{% block title %}Danh sÃ¡ch CLB{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'portal/css/club_list.css' %}">
{% endblock %}

{% block content %}
<section class="club-page">

  <!-- ICON CATEGORY (click Ä‘á»ƒ lá»c field) -->
  <div class="cats">
    <button class="cat {% if request.GET.field == 'hoc-thuat' %}is-active{% endif %}" type="button" data-field="hoc-thuat">
      <span class="cat__circle">ğŸ’¬</span>
      <span class="cat__label">Há»c thuáº­t,<br>ChuyÃªn mÃ´n</span>
    </button>

    <button class="cat {% if request.GET.field == 'nghe-thuat' %}is-active{% endif %}" type="button" data-field="nghe-thuat">
      <span class="cat__circle">ğŸ¨</span>
      <span class="cat__label">Nghá»‡ thuáº­t,<br>SÃ¡ng táº¡o</span>
    </button>

    <button class="cat {% if request.GET.field == 'truyen-thong' %}is-active{% endif %}" type="button" data-field="truyen-thong">
      <span class="cat__circle">ğŸ“£</span>
      <span class="cat__label">Truyá»n thÃ´ng,<br>Dá»‹ch vá»¥</span>
    </button>

    <button class="cat {% if request.GET.field == 'the-thao' %}is-active{% endif %}" type="button" data-field="the-thao">
      <span class="cat__circle">ğŸƒ</span>
      <span class="cat__label">Thá»ƒ thao,<br>Sá»©c khoáº»</span>
    </button>

    <button class="cat {% if request.GET.field == 'so-thich' %}is-active{% endif %}" type="button" data-field="so-thich">
      <span class="cat__circle">â™£ï¸</span>
      <span class="cat__label">Sá»Ÿ thÃ­ch,<br>Giáº£i trÃ­</span>
    </button>

    <button class="cat {% if request.GET.field == 'tinh-nguyen' %}is-active{% endif %}" type="button" data-field="tinh-nguyen">
      <span class="cat__circle">ğŸ¤</span>
      <span class="cat__label">TÃ¬nh nguyá»‡n,<br>Cá»™ng Ä‘á»“ng</span>
    </button>

    <button class="cat {% if request.GET.field == 'ngon-ngu' %}is-active{% endif %}" type="button" data-field="ngon-ngu">
      <span class="cat__circle">ğŸŒ</span>
      <span class="cat__label">NgÃ´n ngá»¯,<br>VÄƒn hoÃ¡</span>
    </button>

    <button class="cat {% if request.GET.field == 'esport' %}is-active{% endif %}" type="button" data-field="esport">
      <span class="cat__circle">ğŸ®</span>
      <span class="cat__label">Thá»ƒ thao,<br>Äiá»‡n tá»­</span>
    </button>
  </div>

  <!-- SEARCH + FILTERS -->
  <form class="toolbar" method="get">
    <div class="search">
      <span class="search__icon">ğŸ”</span>
      <input
        id="qInput"
        type="search"
        name="q"
        value="{{ request.GET.q|default_if_none:'' }}"
        placeholder="TÃ¬m kiáº¿m CÃ¢u Láº¡c Bá»™"
      >
      <button class="search__clear" type="button" id="clearBtn" aria-label="XoÃ¡">âœ•</button>
    </div>

    <div class="filters">
      <select name="field" id="fieldSelect">
        <option value="">Táº¥t cáº£ lÄ©nh vá»±c</option>
        {% for value,label in FIELD_CHOICES %}
          <option value="{{ value }}" {% if request.GET.field == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>

      <select name="status" id="statusSelect">
        <option value="">Tráº¡ng thÃ¡i (Táº¥t cáº£)</option>
        {% for value,label in STATUS_CHOICES %}
          <option value="{{ value }}" {% if request.GET.status == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>

      <a class="btn-ghost" href="{% url 'portal:club_list' %}">Bá» lá»c</a>
    </div>
  </form>

  <!-- RESULT LIST -->
  <div class="result-head">
    <strong>{{ clubs|length }}</strong> CLB
    {% if request.GET.field %}
      <span class="hint">â€¢ Äang lá»c theo lÄ©nh vá»±c</span>
    {% endif %}
    {% if request.GET.status %}
      <span class="hint">â€¢ Tráº¡ng thÃ¡i Ä‘Ã£ chá»n</span>
    {% endif %}
  </div>

  <div class="club-grid">
    {% for club in clubs %}
      <a class="club-card" href="{% url 'portal:club_detail' club.id %}">
        <div class="club-card__avatar">
          {{ club.name|slice:":1"|upper }}
        </div>

        <div class="club-card__info">
          <div class="badges">
            {% if club.field %}
              <span class="badge badge-green">{{ club.get_field_display }}</span>
            {% endif %}
            <span class="badge badge-gray">{{ club.get_status_display }}</span>
          </div>

          <h3 class="title">{{ club.name }}</h3>

          {% if club.faculty %}
            <div class="meta">ğŸ« {{ club.faculty }}</div>
          {% endif %}

          {% if club.description %}
            <p class="desc">{{ club.description|truncatechars:110 }}</p>
          {% else %}
            <p class="desc muted">ChÆ°a cÃ³ mÃ´ táº£.</p>
          {% endif %}
        </div>

        <div class="club-card__cover" aria-hidden="true">
          <div class="cover-text">University Clubs</div>
        </div>
      </a>
    {% empty %}
      <div class="empty">
        <div class="empty__icon">ğŸ”</div>
        <h3>KhÃ´ng cÃ³ CLB phÃ¹ há»£p</h3>
        <p>HÃ£y thá»­ thay Ä‘á»•i bá»™ lá»c hoáº·c báº¥m â€œBá» lá»câ€.</p>
        <a class="btn-ghost" href="{% url 'portal:club_list' %}">Bá» lá»c</a>
      </div>
    {% endfor %}
  </div>

</section>

<script>
  // Submit khi Ä‘á»•i dropdown (US-B1.3)
  document.getElementById("fieldSelect").addEventListener("change", (e) => e.target.form.submit());
  document.getElementById("statusSelect").addEventListener("change", (e) => e.target.form.submit());

  // Click icon -> set field dropdown -> submit (US-B1.3)
  document.querySelectorAll("[data-field]").forEach(btn => {
    btn.addEventListener("click", () => {
      const v = btn.getAttribute("data-field");
      const select = document.getElementById("fieldSelect");
      select.value = v;
      select.form.submit();
    });
  });

  // Clear search
  const qInput = document.getElementById("qInput");
  const clearBtn = document.getElementById("clearBtn");
  function toggleClear(){
    clearBtn.style.visibility = (qInput.value || "").trim() ? "visible" : "hidden";
  }
  toggleClear();
  qInput.addEventListener("input", toggleClear);
  clearBtn.addEventListener("click", () => {
    qInput.value = "";
    toggleClear();
    qInput.form.submit();
  });
</script>
{% endblock %}
