{% extends "portal/base_home.html" %}
{% load static %}

{% block title %}Danh sÃ¡ch CLB{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'portal/css/club_list.css' %}">
{% endblock %}

{% block content %}
<section class="club-page">

  <!-- Top categories row (giá»‘ng hÃ¬nh báº¡n gá»­i) -->
  <div class="club-categories" aria-label="Danh má»¥c CLB">
    <button class="cat" type="button" data-cat="hoc-thuat">
      <span class="cat__icon">ğŸ’¬</span>
      <span class="cat__text">Há»c thuáº­t,<br>ChuyÃªn mÃ´n</span>
    </button>

    <button class="cat" type="button" data-cat="nghe-thuat">
      <span class="cat__icon">ğŸ¨</span>
      <span class="cat__text">Nghá»‡ thuáº­t,<br>SÃ¡ng táº¡o</span>
    </button>

    <button class="cat" type="button" data-cat="truyen-thong">
      <span class="cat__icon">ğŸ“£</span>
      <span class="cat__text">Truyá»n thÃ´ng,<br>Dá»‹ch vá»¥</span>
    </button>

    <button class="cat" type="button" data-cat="the-thao">
      <span class="cat__icon">ğŸƒ</span>
      <span class="cat__text">Thá»ƒ thao,<br>Sá»©c khoáº»</span>
    </button>

    <button class="cat" type="button" data-cat="so-thich">
      <span class="cat__icon">â™£ï¸</span>
      <span class="cat__text">Sá»Ÿ thÃ­ch,<br>Giáº£i trÃ­</span>
    </button>

    <button class="cat" type="button" data-cat="tinh-nguyen">
      <span class="cat__icon">ğŸ¤</span>
      <span class="cat__text">TÃ¬nh nguyá»‡n,<br>Cá»™ng Ä‘á»“ng</span>
    </button>

    <button class="cat" type="button" data-cat="ngon-ngu">
      <span class="cat__icon">ğŸŒ</span>
      <span class="cat__text">NgÃ´n ngá»¯,<br>VÄƒn hoÃ¡</span>
    </button>

    <button class="cat" type="button" data-cat="esports">
      <span class="cat__icon">ğŸ®</span>
      <span class="cat__text">Thá»ƒ thao,<br>Äiá»‡n tá»­</span>
    </button>
  </div>

  <!-- Search + Filters row -->
  <div class="club-toolbar">
    <form class="toolbar" method="get" action="">
      <div class="search">
        <span class="search__icon">ğŸ”</span>
        <input
          id="clubSearch"
          type="search"
          name="q"
          value="{{ request.GET.q|default_if_none:'' }}"
          placeholder="TÃ¬m kiáº¿m CÃ¢u Láº¡c Bá»™"
          autocomplete="off"
        >
        <button class="search__clear" type="button" id="clearSearch" aria-label="XoÃ¡ tá»« khoÃ¡">âœ•</button>
      </div>

      <div class="filters">
        <!-- CÃ¡c filter nÃ y lÃ  UI giá»‘ng máº«u; backend cÃ³ thá»ƒ lÃ m sau -->
        <label class="select">
          <span class="select__label">Khu vá»±c</span>
          <select name="area" id="areaSelect">
            <option value="">Táº¥t cáº£</option>
            <option value="hcm" {% if request.GET.area == "hcm" %}selected{% endif %}>Há»“ ChÃ­ Minh</option>
            <option value="hn" {% if request.GET.area == "hn" %}selected{% endif %}>HÃ  Ná»™i</option>
          </select>
        </label>

        <label class="select">
          <span class="select__label">Thuá»™c trÆ°á»ng</span>
          <select name="school" id="schoolSelect">
            <option value="">Táº¥t cáº£</option>
            <option value="vanhoa" {% if request.GET.school == "vanhoa" %}selected{% endif %}>ÄH VÄƒn hoÃ¡</option>
            <option value="bachkhoa" {% if request.GET.school == "bachkhoa" %}selected{% endif %}>BÃ¡ch khoa</option>
          </select>
        </label>

        <label class="select">
          <span class="select__label">Sáº¯p xáº¿p theo</span>
          <select name="sort" id="sortSelect">
            <option value="alpha" {% if request.GET.sort|default:"alpha" == "alpha" %}selected{% endif %}>Alphabet (A â†’ Z)</option>
            <option value="newest" {% if request.GET.sort == "newest" %}selected{% endif %}>Má»›i nháº¥t</option>
          </select>
        </label>

        <a class="btn btn-ghost" href="{% url 'portal:club_list' %}">Bá» lá»c</a>
      </div>
    </form>
  </div>

  <!-- List -->
  <div class="club-list-wrap">
    <div class="club-count">
      <strong id="resultCount">{{ clubs|length }}</strong> CLB
      {% if request.GET.q %}
        <span class="hint">â€¢ Káº¿t quáº£ cho â€œ{{ request.GET.q }}â€</span>
      {% endif %}
    </div>

    <div class="club-grid" id="clubGrid">
      {% for club in clubs %}
      <article class="club-card" data-name="{{ club.name|lower }}">
        <div class="club-card__left">
          <!-- Avatar (chá»¯ cÃ¡i) -->
          <div class="club-avatar" aria-hidden="true">
            {{ club.name|slice:":1"|upper }}
          </div>
        </div>

        <div class="club-card__main">
          <div class="club-badges">
            {# Náº¿u model cÃ³ field/category thÃ¬ hiá»ƒn thá»‹, khÃ´ng cÃ³ thÃ¬ bá» #}
            {% if club.field %}
              <span class="badge badge-green">{{ club.field }}</span>
            {% elif club.category %}
              <span class="badge badge-green">{{ club.category }}</span>
            {% endif %}

            {% if club.status %}
              <span class="badge badge-gray">{{ club.status }}</span>
            {% endif %}
          </div>

          <h3 class="club-title">{{ club.name }}</h3>

          {% if club.description %}
            <p class="club-desc">{{ club.description|truncatechars:120 }}</p>
          {% else %}
            <p class="club-desc club-desc--muted">ChÆ°a cÃ³ mÃ´ táº£ cho CLB nÃ y.</p>
          {% endif %}

          <div class="club-meta">
            {% if club.location %}
              <span class="meta-item">ğŸ“ {{ club.location }}</span>
            {% elif club.area %}
              <span class="meta-item">ğŸ“ {{ club.area }}</span>
            {% endif %}

            {% if club.school %}
              <span class="meta-item">ğŸ« {{ club.school }}</span>
            {% elif club.faculty %}
              <span class="meta-item">ğŸ« {{ club.faculty }}</span>
            {% endif %}

            {% if club.member_count %}
              <span class="meta-item">ğŸ‘¥ {{ club.member_count }} thÃ nh viÃªn</span>
            {% endif %}
          </div>
        </div>

        <div class="club-card__right">
          {# Náº¿u cÃ³ áº£nh cover/logo thÃ¬ show; náº¿u chÆ°a cÃ³ thÃ¬ show placeholder #}
          {% if club.cover_image %}
            <img class="club-cover" src="{{ club.cover_image.url }}" alt="áº¢nh CLB {{ club.name }}">
          {% elif club.logo %}
            <img class="club-cover" src="{{ club.logo.url }}" alt="Logo CLB {{ club.name }}">
          {% else %}
            <div class="club-cover club-cover--placeholder" aria-hidden="true">
              <div class="ph-title">CLB</div>
              <div class="ph-sub">University Clubs</div>
            </div>
          {% endif %}
        </div>
      </article>
      {% empty %}
      <div class="empty">
        <div class="empty__icon">ğŸ”</div>
        <h3>KhÃ´ng tÃ¬m tháº¥y CLB phÃ¹ há»£p</h3>
        <p>HÃ£y thá»­ tá»« khoÃ¡ khÃ¡c hoáº·c báº¥m â€œBá» lá»câ€.</p>
        <a class="btn" href="{% url 'portal:club_list' %}">Quay vá» danh sÃ¡ch</a>
      </div>
      {% endfor %}
    </div>
  </div>

</section>

<script>
  // US-B1.2: nháº­p tá»« khoÃ¡ -> lá»c theo tÃªn; xoÃ¡ tá»« khoÃ¡ -> hiá»‡n láº¡i Ä‘áº§y Ä‘á»§
  (function () {
    const input = document.getElementById("clubSearch");
    const clearBtn = document.getElementById("clearSearch");
    const grid = document.getElementById("clubGrid");
    const cards = Array.from(grid.querySelectorAll(".club-card"));
    const countEl = document.getElementById("resultCount");

    function applyFilter() {
      const q = (input.value || "").trim().toLowerCase();
      let visible = 0;

      cards.forEach(card => {
        const name = card.getAttribute("data-name") || "";
        const ok = !q || name.includes(q);
        card.style.display = ok ? "" : "none";
        if (ok) visible++;
      });

      if (countEl) countEl.textContent = String(visible);
      clearBtn.style.visibility = q ? "visible" : "hidden";
    }

    clearBtn.addEventListener("click", () => {
      input.value = "";
      input.focus();
      applyFilter();
    });

    input.addEventListener("input", applyFilter);

    // init
    applyFilter();
  })();
</script>
{% endblock %}
